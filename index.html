 <!doctype html>
<html lang="mn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Амьд Бие — WebAR (No Camera · Subtitles)</title>
  <style>
    html,body{margin:0;height:100%;background:#0b0b0f;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    #wrap{position:relative;height:100vh;overflow:hidden;
      background: radial-gradient(80% 80% at 50% 30%, #1c2531 0%, #0b0b0f 60%);}
    #webgl{position:absolute;inset:0;width:100%;height:100%}
    #msg{position:absolute;left:0;right:0;top:64px;text-align:center;font-size:20px;line-height:1.45;text-shadow:0 2px 8px rgba(0,0,0,.7);padding:0 16px}
    .child{position:absolute;right:6%;bottom:18%;width:min(28%,220px);opacity:0;transition:opacity .8s}
    .visible{opacity:1!important}
    .ui{position:absolute;left:0;right:0;bottom:40px;display:flex;gap:8px;justify-content:center}
    button{padding:12px 16px;border:0;border-radius:12px;font-weight:700;cursor:pointer}
    .ghost{background:rgba(255,255,255,.18);color:#fff}
    .primary{background:#ff7b47;color:#000}
    #timeline{position:absolute;left:0;right:0;bottom:0;height:4px;background:rgba(255,255,255,.12)}
    #progress{height:100%;width:0%;background:linear-gradient(90deg,#ff3b3b,#ff9a3b)}
    .brand{position:absolute;top:12px;left:12px;padding:6px 10px;border-radius:10px;
      background:rgba(0,0,0,.35);backdrop-filter:blur(4px);font-weight:700;font-size:14px;letter-spacing:.2px}
    .brand small{opacity:.8;font-weight:500}
  </style>
</head>
<body>
<div id="wrap">
  <div class="brand">Амьд Бие <small>· Амьдралаа хамгаал</small></div>

  <!-- Статичен WebGL рендер върху фон (без камера) -->
  <canvas id="webgl"></canvas>

  <!-- Детето (показва се на съответния тайминг) -->
  <img id="child" class="child" src="assets/svg/child.svg" alt="child">

  <!-- Субтитри -->
  <div id="msg"></div>

  <!-- Контроли -->
  <div class="ui">
    <button class="ghost" id="start">▶️ Стартирай</button>
    <button class="primary" id="cta">Амьдралаа хамгаал</button>
  </div>

  <!-- Прогрес лента -->
  <div id="timeline"><div id="progress"></div></div>
</div>

<!-- Three.js за 3D модел -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/examples/js/loaders/GLTFLoader.min.js"></script>
<script>
const SITE_URL = "https://stefan064113.github.io/amid-bie-webar/";
const msg = document.getElementById('msg');
const childImg = document.getElementById('child');
const progressBar = document.getElementById('progress');

document.getElementById('cta').addEventListener('click', ()=>{ location.href = SITE_URL; });

/* ---------- Субтитри (без аудио) ---------- */
const SCRIPT = [
  { t: 0,  text: 'Чи өөрийгөө харж байна уу?' },
  { t: 4,  text: 'Энэ бол таны уушги... хэрвээ та өдөр бүр тамхи татвал.' },
  { t: 8,  text: 'Кхх... (кашляне) — хүүхэд тань хажууд байна.' , showChild: true },
  { t: 11, text: 'Таны утаа намайг хордуулж байна...' },
  { t: 14, text: 'Гэхдээ зөвхөн та биш... таны хажууд байгаа хүүхэд ч бас хорлогдож байна.' },
  { t: 16, text: 'Өнөөдөр тамхинаас татгалз— амьдралаа хамгаал.' }
];

let total = 18, start = 0, raf;
function tick(){
  const t = (performance.now()-start)/1000;
  const p = Math.min(1, t/total);
  progressBar.style.width = (p*100)+'%';
  raf = requestAnimationFrame(tick);
}
document.getElementById('start').addEventListener('click', ()=>{
  start = performance.now();
  cancelAnimationFrame(raf); tick();
  childImg.classList.remove('visible');
  msg.textContent = '';

  let i = 0;
  function step(){
    const t = (performance.now()-start)/1000;
    while (i < SCRIPT.length && t >= SCRIPT[i].t){
      msg.textContent = SCRIPT[i].text;
      if (SCRIPT[i].showChild) childImg.classList.add('visible');
      i++;
    }
  }
  // Safari-safe: комбинираме rAF + setInterval
  requestAnimationFrame(function loop(){ step(); requestAnimationFrame(loop); });
  setInterval(step, 500);
});

/* ---------- Минимална 3D сцена (lungs.gltf), без камера ---------- */
const canvas3d = document.getElementById('webgl');
let renderer, scene, camera, lungs, tClock = new THREE.Clock();

(function init3D(){
  renderer = new THREE.WebGLRenderer({ canvas: canvas3d, alpha:true, antialias:true });
  renderer.setPixelRatio(window.devicePixelRatio || 1);
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(40, 1, 0.1, 100);
  camera.position.set(0, 0, 8);

  // светлини
  const dl = new THREE.DirectionalLight(0xffffff, 1.1); dl.position.set(1,2,2); scene.add(dl);
  scene.add(new THREE.AmbientLight(0xffffff, 0.6));

  // плавно „дишане“ на белите дробове (леко пулсиране)
  function breathe(){
    const t = tClock.getElapsedTime();
    if (lungs) {
      const s = 1 + Math.sin(t*1.5)*0.03;
      lungs.scale.set(s, s, s);
      lungs.rotation.y += 0.0025;
    }
  }

  // зареждане на модела
  new THREE.GLTFLoader().load('assets/models/lungs.gltf', g=>{
    lungs = g.scene;
    lungs.position.set(0, -0.5, 0);
    scene.add(lungs);
  });

  onResize(); window.addEventListener('resize', onResize);
  (function animate(){
    requestAnimationFrame(animate);
    breathe();
    renderer.render(scene, camera);
  })();
})();

function onResize(){
  const rect = canvas3d.getBoundingClientRect();
  const w = rect.width || window.innerWidth;
  const h = rect.height || window.innerHeight;
  renderer.setSize(w, h, false);
  camera.aspect = w / h; camera.updateProjectionMatrix();
}
</script>
</body>
</html>

  
   

